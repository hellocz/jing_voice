var zhiyou_relate={baseUrl:"http://zhiyou.smzdm.com/",loginUrl:"https://zhiyou.smzdm.com/",init:function(){var me=this;$(function(){me.init_login_area()})},popup_login_init:function(config){var redirect_url=window.location.href;if(config.redirect_url!=undefined){redirect_url=config.redirect_url}var iframe_url="https://zhiyou.smzdm.com/user/login/window#redirect_url="+encodeURIComponent(redirect_url);var iframe_html='<div class="pop" id="pop-login-new" style="display:none;margin-left:-240px;top:30%;">'+'<i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i>'+'<div class="pop-title">'+'<div class="pop_name">登录</div>'+'<a href="'+zhiyou_relate.loginUrl+'user/register/mobile" class="a_underline" _hover-ignore="1">注册</a>'+"</div>"+'<div class="pop-content">'+'<iframe id="zhiyou_login_window_iframe" frameborder="0" style="width:300px;height:290px;" src='+iframe_url+' scrolling="no"></iframe>'+"</div></div>"+'<div id="cover" style="display: none;"></div>';var length="",login_pop="",cover="";if($("#pop-login-new").length<=0){$("#footer").after(iframe_html)}login_pop=$("#pop-login-new");cover=$("#cover");$(document).on("click",".zhiyou_login",function(){login_pop.show();cover.show();return false});$("#pop-login-new").delegate(".pop-close","click",function(){login_pop.hide();cover.hide()});$(document).on("click","#cover",function(){login_pop.hide();cover.hide()})},popup_login_show:function(){$("#pop-login-new").show();$("#cover").show();return false},get_header_menu_tpl:function(){var login_area_dom=$("#zhiyouLoginArea");var isHideLogin=login_area_dom.data("ishidelogin");if(isHideLogin){var loginHtml=""}else{var loginHtml='<a href="'+zhiyou_relate.loginUrl+'user/register/mobile" class="navBarRegister" id="navBar_reg" >注册</a>'+'<a href="javascript:;" id="login_window" class="zhiyou_login navBarLogin">登录<span class="line"></span></a>'}var download_app_html='<div class="downloadApp">'+'<a href="http://www.smzdm.com/push" target="_blank" class="app"><i class="icon-iPhoneIcon"></i>App&nbsp;下载</a>'+'<div class="more-share-box">'+'<span class="arrow-top"><em class="arrow-top"></em></span>'+'<div class="more-share">'+'<a href="http://www.smzdm.com/push" class="app-box" target="_blank">'+'<img src="http://zhiyou.smzdm.com/resources/img/app_logo.png" alt="" />'+"<b>折扣再多，值才重要</b>"+"</a>"+'<img src="http://res.smzdm.com/images/app.png" alt="" />'+"<p>App&nbsp;下载</p>"+'<p class="red">领取<i>5</i>金币</p>'+"</div>"+"</div>"+"</div>";var header_menu_tpl=loginHtml+'<div class="login_Info" id="navBar_login_Info">'+'<a href="'+me.baseUrl+'user" target="_blank" class="nickName"></a>'+'<i class="icon-down"><!--[if lt IE 8]>&gt;<![endif]--></i>'+'<div class="more_login_Info">'+'<span class="arrow-top"><em></em></span>'+'<ul aria-haspopup="true">'+'<li><a href="http://zhiyou.smzdm.com/user" target="_blank">个人中心</a></li>'+'<li><a href="http://zhiyou.smzdm.com/user/mypost" target="_blank">我的原创</a></li>'+'<li><a href="http://zhiyou.smzdm.com/user/submit" target="_blank">我的爆料</a></li>'+'<li><a href="http://zhiyou.smzdm.com/user/wiki" target="_blank">我的百科</a></li>'+'<li id="user_menu_comment"><a href="http://zhiyou.smzdm.com/user/shoudaopinglun" >我的评论</a></li>'+'<li ><a href="http://test.smzdm.com/user/zhongce">我的众测</a></li>'+'<li id="user_menu_message"><a href="http://zhiyou.smzdm.com/user/message" >我的消息</a></li>'+'<li><a href="http://zhiyou.smzdm.com/user/favorites/youhui">我的收藏</a></li>'+'<li><a href="http://zhiyou.smzdm.com/user/2">我的闲置</a></li>'+'<li><a href="http://zhiyou.smzdm.com/user/logout">退出登录</a></li>'+"</ul>"+"</div>"+"</div>"+'<div class="submission"> '+'<a href="#">爆料投稿</a>'+'<i class="icon-down"><!--[if lt IE 8]>&gt;<![endif]--></i>'+'<div class="more_submission">'+'<span class="arrow-top"><em></em></span>'+"<ul>"+'<li><a href="http://www.smzdm.com/baoliao/" target="_blank">优惠爆料</a></li>'+'<li><a href="http://wiki.smzdm.com/create/" target="_blank">分享商品</a></li>'+'<li><a href="http://post.smzdm.com/tougao/" target="_blank">原创投稿</a></li>'+"</ul>"+"</div>"+"</div>"+download_app_html+'<div class="more_user_news" id="chief_notice" style="display: none;">'+'<i class="icon-cross-lighter" onclick="javascript:$(this).parent().fadeOut();"></i>'+'<a id="notice_message" href="#"><em></em>条新消息</a>'+'<a id="notice_comment" href="#"><em></em>条新评论</a>'+"</div>";return header_menu_tpl},init_login_area:function(login_area){me=this;var login_area_dom=$("#zhiyouLoginArea");login_area_dom.append(me.get_header_menu_tpl())},request_zhiyou_info:function(callback){var me=this;var baseUrl=me.baseUrl;if(window.location.protocol==="https:"){baseUrl=baseUrl.replace(/http/g,"https")}var userUrl=baseUrl+"user/info/jsonp_get_current";$.ajax({type:"get",url:userUrl,data:"",dataType:"jsonp",jsonp:"callback",success:function(resp){me.user_info_default_callback(resp);if(typeof callback=="function"){callback(resp)}},error:function(){}})},bgm:{},user_info_default_callback:function(resp){var me=zhiyou_relate;if(resp&&!$.isEmptyObject(resp)){if(resp["bgm"]&&!$.isEmptyObject(resp["bgm"])){zhiyou_relate.bgm=resp["bgm"]
}var smzdm_id=resp.smzdm_id;var nickname=resp.nickname;var unread=resp.unread;var logo=resp.logo;var authority=resp.capabilities;var a=resp.avatar.split("small");var avatarUrl=typeof(a[0])!="undefined"?a[0]:"";if(typeof(a[1])!="undefined"){avatarUrl+="middle"+a[1]}var personLink=zhiyou_relate.baseUrl+"user";var point=resp.point;var gold=resp.gold;var is_anonymous="";var checkin=resp.checkin;var commentConnect=resp.comment_sync_sina;$("body").append('<input id="log_status" type="hidden" value="1" />');if(authority!=""){if(authority.administrator||authority.editor||authority.pinglun||authority.edit_posts||authority.moderate_comments){$("body").append('<input type="hidden" id="authority" value="editor" />');$("#authority").val("all")}}$("#navBar_login,#navBar_reg, #login_window").hide();$("#navBar_login_Info").find(".nickName").html(nickname);$("#navBar_login_Info").show();if($("#user_info").length>0){$("#user_info").attr("class","userInfo user_signIn");$("#sign_login").hide();$("#user_info_avatar").attr({"src":avatarUrl,"alt":nickname}).unwrap("span").wrap('<a href=" '+personLink+' " class="userPic" target="_blank"></a>');$("#user_info_name").html('<a href=" '+personLink+' " title=" '+nickname+' " target="_blank">'+nickname+"</a>"+logo.medal+logo.zhongce_grade+logo.goldbl+" "+logo.rank);if($("#user_info_score").find("em").length>0){$("#user_info_score").find("em").html(point).end().next("a").andSelf().show()}else{$("#user_info_score").html("积分:<em>"+point+"</em>")}if($("#user_info_gold").find("em").length>0){$("#user_info_gold").find("em").html(gold).end().next("a").andSelf().show()}else{$("#user_info_gold").html("金币:<em>"+gold+"</em>")}var mobileTips=parseInt($("#user_info").attr("needMobileTips"));if(mobileTips!=1){}$("#user_info_tosign").unbind("click").bind("click",zhiyou_relate.set_checkin);if(checkin.has_checkin){$("#user_info_tosign").html("已签到"+checkin.daily_checkin_num+"天").removeClass("signScore").addClass("signScored").removeClass("zhiyou_login").unbind("click");if(mobileTips!=1){$("#user_info_tosign").attr("href","http://www.smzdm.com/qiandao ")}}$("#user_info_tosign").removeClass("zhiyou_login");var channel=$("#channel").val();if(channel!="index"){var slogan=checkin.slogan;$(".scoreBox").after(slogan)}}if(is_anonymous&&1==is_anonymous){$("#comment_avatar").attr({"src":no_avatar,"alt":"匿名用户"}).unwrap("span").wrap('<a href="javascript:void(0);" class="userPic"></a>');$("#comment_avatar").parent(".userPic").after(' <span class="comment_nickName grey">匿名用户</span> ')}else{$("#comment_avatar").attr({"src":avatarUrl,"alt":nickname}).unwrap("span").wrap('<a href=" '+personLink+' " class="userPic" target="_blank" title=" '+nickname+' "></a>');$("#comment_avatar").parent(".userPic").after(' <a href=" '+personLink+' " class="comment_nickName a_underline" target="_blank"  title=" '+nickname+' ">'+nickname+"</a> ")}$(".comment_switch").show(function(){if(commentConnect&&$("#commentform").find(".check").length>0){$("#comments .comment_share i.check").addClass("icon-rightframe")}else{if(commentConnect&&$("#commentform").find(".check").length>0){$("#comments .comment_share i.check").removeClass("icon-rightframe")}}});if(unread["notice"]["num"]!=0||unread["pm"]["num"]!=0||unread["comment"]["num"]!=0){var messageNum=parseInt(unread["notice"]["num"])+parseInt(unread["pm"]["num"]);if(messageNum!=0){var messageUrl=unread["notice"]["url"];if(parseInt(unread["notice"]["num"])<=0){messageUrl=unread["pm"]["url"]}$("#notice_message").attr("href",messageUrl).find("em").html(messageNum);if(messageNum>99){messageNum="99+"}$("#user_menu_message").find("a").attr("href",messageUrl).html("我的消息<span>(<em>"+messageNum+"</em>)</span>")}else{$("#notice_message").hide()}if(unread["comment"]["num"]!=0){var commentUrl=unread["comment"]["url"];$("#notice_comment").attr("href",commentUrl).find("em").html(unread["comment"]["num"]);if(unread["comment"]["num"]>99){unread["comment"]["num"]="99+"}$("#user_menu_comment").find("a").attr("href",commentUrl).html("我的评论<span>(<em>"+unread["comment"]["num"]+"</em>)</span>")}else{$("#notice_comment").hide()}$("#chief_notice").show().find(".close").click(function(){$("#chief_notice").hide()});$("#chief_notice").slideDown("slow")}else{$("#chief_notice").hide()}$("#comment_tips").remove();$("#textareaComment").removeClass("zhiyou_login");$(".noLogin").removeClass("noLogin");var defaultText=$("#textareaComment").attr("default_data");$("#textareaComment").unbind("click").val(defaultText).focus(function(){if($(this).val()==defaultText){$(this).val("")}$(this).css("color","#666")}).blur(function(){if($(this).val()==""){$(this).val(defaultText).css("color","#ccc")}}).change(function(){$("#textCommentSubmit").removeAttr("disabled")});$("#textCommentSubmit").removeAttr("disabled").removeClass("btn_subGrey").addClass("btn_sub");var banright=resp.banright;if(banright.length>0){for(var i=0,len=banright.length;i<len;i++){if(banright[i]==1){var banMessage=resp.bantips;$("#textareaComment").html("").attr("disabled","disabled");
$("#comment_error").html(banMessage).show();$("#textCommentSubmit").removeClass("btn_sub").addClass("btn_subGrey").attr("disabled","disabled");$(".comment_switch").hide();$(".atta,.reply").unbind("click");break}}}showHidenNotice(".login_Info","#chief_notice");showHidenNotice(".submission","#chief_notice");var loginError=parseInt(resp.login_error_num);if(loginError>=3){var source=$("#captcha_img").attr("data-src");$("#captcha_img").attr("src",source);$(".captcha_switch").show()}if(resp.close_comment_enter){$("#textareaComment").html("").attr("disabled","disabled");$("#textCommentSubmit").removeClass("btn_sub").addClass("btn_subGrey").attr("disabled","disabled");$(".comment_switch").hide();$(".atta,.reply").unbind("click")}if(resp.is_use_captcha){var source=$("#captcha_img").attr("data-src");$("#captcha_img").attr("src",source);$(".captcha_switch").show()}if(resp.bgm&&resp.bgm.permission&&resp.bgm.permission.commentpermission){init_action();$("#comment").append('<input type="hidden" readonly="readonly" id="is_bgm" name="is_bgm" value="1" />')}}else{zhiyou_relate.footer_login_layer_init()}return},set_checkin:function(){var me=this;$("#user_info_tosign").unbind("click");$.ajax({type:"get",url:zhiyou_relate.baseUrl+"user/checkin/jsonp_checkin",dataType:"jsonp",jsonp:"callback",success:function(resp){var error_code=resp.error_code;var error_msg=resp.error_msg;var data=resp.data;if(error_code==0){window.location.href="http://www.smzdm.com/qiandao"}else{popUp("","#pop-status",error_msg["public"])}},error:function(){$("#user_info_tosign").bind("click",zhiyou_relate.set_checkin)}})},add_favorite:function(article_id,channel_id,obj){var me=this;var favoriteUrl=me.baseUrl+"user/favorites/";$.ajax({type:"get",url:favoriteUrl+"jsonp_favorite",data:{article_id:article_id,channel_id:channel_id},dataType:"jsonp",jsonp:"callback",success:function(resp){var channel_map={3:"youhui",6:"news",11:"yuanchuang",7:"zhongce",8:"pingce",16:"2"};if(resp.error_code==0){$("#pop-collect .pop_info_show a:first").attr("href",favoriteUrl+channel_map[channel_id]);if(channel_id==7){channel_id=8}else{if(channel_id==8){channel_id=7}}popPosition("#pop-collect");$("#pop-collect").show();$("#cover").show();popClose("#pop-collect");$("a[id='collect_"+channel_id+"_"+article_id+"']").each(function(){$(this).attr("class","fav current");var favorite_num=Number($(this).find("em").html())+1;if(favorite_num<0){favorite_num=0}$(this).find("em").html(favorite_num)});popUp("","#pop-collect","")}else{if(resp.error_code==2){$("#pop-nocollect .pop_info_show a:first").attr("href",favoriteUrl+channel_map[channel_id]);if(channel_id==7){channel_id=8}else{if(channel_id==8){channel_id=7}}popPosition("#pop-nocollect");$("#pop-nocollect").show();$("#cover").show();popClose("#pop-nocollect");$("a[id='collect_"+channel_id+"_"+article_id+"']").each(function(){$(this).attr("class","fav");var favorite_num=Number($(this).find("em").html())-1;if(favorite_num<0){favorite_num=0}$(this).find("em").html(favorite_num)});popUp("","#pop-nocollect","")}else{if(resp.error_code==5){me.popup_login_show()}else{if(resp.error_code==6){}}}}},error:function(){}})},init_favorite_by_cookie:function(){$(".fav").each(function(){var type=new Array([3,"youhui"],[6,"news"],[8,"test"],[7,"test_probation"],[11,"yuanchuang"],[16,"second"]);var id=$(this).attr("id");if(typeof(id)!="undefined"){var idarr=id.split("_");var article_id=idarr[2];var atype=idarr[1];for(i=0;i<type.length;i++){var cook=getCookie("smzdm_collection_"+type[i][1]);var cookarr=[];if(cook){var cookarr=cook.split(",")}if(atype==type[i][0]&&$.inArray(article_id,cookarr)>-1){$(this).attr("class","fav current")}}}})},scored:function(id,currentStyle){var zan_box=$(id);if(zan_box.find("a").hasClass(currentStyle)){zan_box.mouseover(function(){$(this).find("."+currentStyle).css("display","none");$(this).find(".scoredInfo").css("display","block")});zan_box.mouseout(function(){$(this).find("."+currentStyle).css("display","block");$(this).find(".scoredInfo").css("display","none")})}},zhi_list_callback:function(resp,article_id,channel_id,rating,obj){if(rating==1){var worthy_obj=$("#rating_worthy_"+article_id);worthy_obj.find(" .scoreAnimate").fadeIn().animate({top:"-30px"},"normal").fadeOut(300);if(worthy_obj.find("em").length){var score=parseInt($.trim(worthy_obj.find("em").html()))}else{var scoreText=worthy_obj.find(" .scoreTotal").text();var scoreArr=scoreText.split(" ");var score=parseInt(scoreArr[1])}var score=score+1;if(worthy_obj.find(" .scoreTotal").length){worthy_obj.find(" .scoreTotal").html("<b>值</b> "+score)}else{worthy_obj.find("em").html(score)}}else{var unworthy_obj=$("#rating_unworthy_"+article_id);unworthy_obj.find(" .scoreAnimate").fadeIn().animate({top:"30px"},"normal").fadeOut(300);if(unworthy_obj.find(" .scoreTotal em").length>0){var score=parseInt($.trim(unworthy_obj.find(" .scoreTotal em").html()))}else{var scoreText=unworthy_obj.find(" .scoreTotal").text();var scoreArr=scoreText.split(" ");var score=parseInt(scoreArr[1])}var score=score+1;
unworthy_obj.find(" .scoreTotal").html("<b>不值</b> "+score)}},zhi_detail_callback:function(resp,article_id,channel_id,rating,obj){var rating_obj=$("#rating_"+article_id),percentage;var n=parseInt($.trim($("#rating_worthy_num").text()));var m=parseInt($.trim($("#rating_unworthy_num").text()));if(rating==1){$(rating_obj).find(".add").show().animate({"top":"-30px"},600).fadeOut("slow",function(){$("#rating_worthy_num").html(n+1);$("#rating_all_num").html("已有 "+(n+m+1)+" 用户参与")});percentage=(n+1)/(n+m+1)*100}else{$(rating_obj).find(".reduce").show().animate({"top":"80px"},600).fadeOut("slow",function(){$("#rating_unworthy_num").html(m+1);$("#rating_all_num").html("已有 "+(n+m+1)+" 用户参与")});percentage=(n)/(n+m+1)*100}rating_obj.find(" .progressing").css("width",percentage.toString()+"%")},zan_callback:function(resp,article_id,channel_id,rating,obj){var me=this;$(obj).find("span.addNumber").fadeIn().animate({top:"-35px"},"normal").fadeOut(300);$(obj).attr("class","zan current");zhiyou_relate.scored("#details-zan","current");if($(obj).find("em").length>0){$(obj).find("span.scoreAnimate").fadeIn().animate({top:"-35px"},"normal").fadeOut(300,function(){$(obj).find("em").html(Number($(obj).find("em").html())+1)})}else{if($(obj).parents(".show_exp_zan").find("em").length>0){$(obj).parents(".show_exp_zan").find("em").html(Number($(obj).parents(".show_exp_zan").find("em").html())+1)}else{$(obj).parents(".show_exp_zan").find(".grey").html("已有<em>1</em>人赞过")}}},add_rating:function(type,article_id,channel_id,rating,obj){var me=this;if(type=="zan"){var callback=me.zan_callback;$(obj).removeAttr("onclick");$(obj).css("cursor","default")}else{if(type=="zhi_list"){var callback=me.zhi_list_callback;var worthy_obj=$("#rating_worthy_"+article_id);var unworthy_obj=$("#rating_unworthy_"+article_id);worthy_obj.removeAttr("onclick").css("cursor","default");unworthy_obj.removeAttr("onclick").css("cursor","default");if(rating==1){worthy_obj.addClass("current").addClass("worthCurrent");unworthy_obj.addClass("unworthCurrent")}else{worthy_obj.addClass("worthCurrent");unworthy_obj.addClass("current").addClass("unworthCurrent")}}else{if(type=="zhi_in"){var callback=me.zhi_detail_callback;var rating_obj=$("#rating_"+article_id);var worthy_obj=$("#rating_worthy");var unworthy_obj=$("#rating_unworthy");worthy_obj.removeAttr("onclick").css("cursor","default").addClass("worthCurrent");unworthy_obj.removeAttr("onclick").css("cursor","default").addClass("unworthCurrent");zhiyou_relate.scored("#details-zhi","worthCurrent");zhiyou_relate.scored("#details-buzhi","unworthCurrent")}}}$.ajax({type:"get",url:me.baseUrl+"user/rating/jsonp_add",data:{article_id:article_id,channel_id:channel_id,rating:rating},dataType:"jsonp",jsonp:"callback",success:function(resp){callback(resp,article_id,channel_id,rating,obj)},error:function(){}})},init_rating_by_cookie:function(){var channel_map=[0,3,6,7,8,9,10,11,16];for(var i=1,len=channel_map.length;i<len;i++){var channel_id=channel_map[i];var rating_key="smzdm_rating_"+channel_id;var rating_cookie_json=getCookie(rating_key);if(rating_cookie_json){rating_cookie=json_decode(rating_cookie_json);if(channel_id==3){if($(".lrBot").length){$(".lrBot").each(function(){if(typeof($(this).find(" .good").attr("id"))!="undefined"){var article_id=$(this).find(" .good").attr("id").split("_")[2];if(article_id in rating_cookie){var worthy_obj=$("#rating_worthy_"+article_id);if(worthy_obj.length>0){var unworthy_obj=$("#rating_unworthy_"+article_id);worthy_obj.removeAttr("onclick");unworthy_obj.removeAttr("onclick");if(rating_cookie[article_id]==1){worthy_obj.addClass("current").css("cursor","default").addClass("worthCurrent");unworthy_obj.css("cursor","default").addClass("unworthCurrent")}else{if(rating_cookie[article_id]==-1){worthy_obj.css("cursor","default").addClass("worthCurrent");unworthy_obj.addClass("current").css("cursor","default").addClass("unworthCurrent")}}}}}})}if($(".zan_fav_com").length){$(".zan_fav_com").each(function(){if(typeof($(this).find(" .zan").attr("id"))!="undefined"){var article_id=$(this).find(" .zan").attr("id").split("_")[2];if(article_id in rating_cookie){var worthy_obj=$("#rating_worthy_"+article_id);if(worthy_obj.length>0){worthy_obj.removeAttr("onclick");if(rating_cookie[article_id]==1){worthy_obj.addClass("current").css("cursor","default")}}}}})}$(".score_rateBox").each(function(){if(typeof($(this).attr("id"))!="undefined"){var article_id=$(this).attr("id").split("_")[1];if(article_id in rating_cookie){var worthy_obj=$("#rating_worthy");if(worthy_obj.length>0){var unworthy_obj=$("#rating_unworthy");worthy_obj.removeAttr("onclick").css("cursor","default");unworthy_obj.removeAttr("onclick").css("cursor","default");worthy_obj.addClass("worthCurrent");unworthy_obj.addClass("unworthCurrent");scored("#details-zhi","worthCurrent");scored("#details-buzhi","unworthCurrent")}}}})}else{$(".zan").each(function(){var id=$(this).attr("id");if(typeof(id)!="undefined"){var idarr=id.split("_");var article_id=idarr[3];var select_channel_id=idarr[2];
if(select_channel_id==7){select_channel_id=8}else{if(select_channel_id==8){select_channel_id=7}}if(channel_id==select_channel_id&&article_id in rating_cookie){$(this).attr("class","zan current");$(this).removeAttr("onclick");$(this).css("cursor","default")}}})}}}},};zhiyou_relate.setCookie=function(cookieName,cookieValue,seconds,path,domain,secure){seconds=seconds?seconds:604800;seconds=seconds*1000;var expires=new Date();expires.setTime(expires.getTime()+seconds);document.cookie=escape(cookieName)+"="+escape(cookieValue)+(expires?"; expires="+expires.toGMTString():"")+(path?"; path="+path:"/")+(domain?"; domain="+domain:"")+(secure?"; secure":"");return};zhiyou_relate.footer_login_layer_init=function(){var ele=".footer_login_layer";if($(ele).length<=0){return}var login_layer_show_gtm=$(ele).data("login_layer_show_gtm"),click_login_gtm=$(ele).data("click_login_gtm"),click_register_gtm=$(ele).data("click_register_gtm"),click_close_gtm=$(ele).data("click_close_gtm");var footer_ele="#footer_layer";var cookie_name="has_show_login_layer";var footer_layer_tpl='<div class="footer-layer" id="footer_layer" style="display:none">'+'<div class="layer-center">'+'<div class="layer-left">'+"<ul>"+'<li><img src="http://res.smzdm.com/images/zhiyou/material/footer_login_layer.png"/></li>'+'<li style="margin-top: 5px;"><button class="Login zhiyou_login" onclick="dataLayer.push({\'event\':\''+click_login_gtm+"'})\">登录</button></li>"+"<li style=\"margin-top: 5px;\"><button class=\"register\" onclick=\"window.open('http://zhiyou.smzdm.com/user/register/mobile','_blank');dataLayer.push({'event':'"+click_register_gtm+"'})\" >注册</button></li>"+"</ul>"+"</div>"+'<div class="layer-right" id="del_layer"><i class="icon-cross-lighter close_footer_layer" onclick="dataLayer.push({\'event\':\''+click_close_gtm+"'})\"></i></div>"+"</div>"+"</div>";var has_show_login_layer=getCookie(cookie_name);if(has_show_login_layer=="1"){return false}if($(footer_ele).length>=0){$(footer_ele).remove()}$("footer").after(footer_layer_tpl);if(typeof dataLayer!="undefined"){dataLayer.push({event:"virtualPageview",page:login_layer_show_gtm})}$(footer_ele).show();$(".close_footer_layer").click(function(){var that=$(this);$(footer_ele).hide();zhiyou_relate.setCookie(cookie_name,"1",604800,"/",".smzdm.com")})};zhiyou_relate.init();var smzdm_domain=".smzdm.com";var comment_report_cookiename="comment_report";window.comment_report_cookie_list;var comment_rating_cookiename="comment_rating";window.comment_rating_cookie_list;var StringBuilder=function(d){this.s=new Array(d);this.onMultiAppendBeforeHandle=null;this.onMultiAppendBefore=function(param){this.onMultiAppendBeforeHandle=param;return this};this.append=function(d){this.s.push(d);return this};this.toString=function(){return this.s.join("")};this.clear=function(){this.s=new Array()};this.appendMultiFormat=function(format_str,data){if(typeof(data)=="object"){for(var i in data){if(this.onMultiAppendBeforeHandle!=null){this.onMultiAppendBeforeHandle(data[i])}this.appendFormat(format_str,data[i])}}return this};this.appendFormat=function(){var n=arguments.length;if(n==0){return this}var f=arguments[0];if(n==1){return this.append(f)}var arg=arguments[1];if(arg==null){arg=""}var i,e,c,k,akFun;if(typeof(arg)=="object"){akFun=function(a,k){return a[1][k]}}else{akFun=function(a,k){return a[k-0+1]}}for(i=0;i<f.length;){c=f.charAt(i);if(c=="{"){e=f.indexOf("}",i);k=f.substring(i+1,e);this.s.push(akFun(arguments,k));i=e+1;continue}this.s.push(c);i++}return this}};function popPosition(o){var wrapWidth=$(window).width();var wrapHeight=$(window).height();var oWidth=$(o).width();var oHeight=$(o).height();$(o).css({left:wrapWidth/2-oWidth/2,top:wrapHeight/2-oHeight/2})}$.fn.autoTextarea=function(options){if($("#quickReply")){var defaults={maxHeight:null,minHeight:$(this).height()};var opts=$.extend({},defaults,options);$(this).bind("paste cut keydown keyup focus blur",function(){var height,style=this.style;this.style.height=opts.minHeight+"px";var padding_top_obj=$(this).css("padding-top").split("",1);var padding_top=parseInt(padding_top_obj);if(this.scrollHeight>opts.minHeight){if(opts.maxHeight&&this.scrollHeight>opts.maxHeight){height=opts.maxHeight-padding_top;style.overflowY="scroll"}else{height=this.scrollHeight-padding_top;style.overflowY="hidden"}style.height=(height-padding_top)+"px"}})}};function json_encode(mixed_val){var json=this.window.JSON;if(typeof json==="object"&&typeof json.stringify==="function"){return json.stringify(mixed_val)}var value=mixed_val;var quote=function(string){var escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'};
var str=function(key,holder){var gap="";var indent="    ";var i=0;var k="";var v="";var length=0;var mind=gap;var partial=[];var value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}};return str("",{"":value})}function json_decode(str_json){var json=this.window.JSON;if(typeof json==="object"&&typeof json.parse==="function"){return json.parse(str_json)}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var j;var text=str_json;cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return j}throw new SyntaxError("json_decode")}function getCookie(name){var cookie_start=document.cookie.indexOf(name);var cookie_end=document.cookie.indexOf(";",cookie_start);return cookie_start==-1?"":unescape(document.cookie.substring(cookie_start+name.length+1,(cookie_end>cookie_start?cookie_end:document.cookie.length)))}function setCookie(cookieName,cookieValue,seconds,path,domain,secure){seconds=seconds?seconds:604800;seconds=seconds*1000;var expires=new Date();expires.setTime(expires.getTime()+seconds);document.cookie=escape(cookieName)+"="+escape(cookieValue)+(expires?"; expires="+expires.toGMTString():"")+(path?"; path="+path:"/")+(domain?"; domain="+domain:"")+(secure?"; secure":"");return}function setCookieArr1(cookieName,data,seconds,path,domain,secure){var result_json=getCookie(cookieName);var one_list;if(result_json){one_list=json_decode(result_json)}if(one_list){var one_list_length=one_list.length;if(one_list_length>=cookie_length_limit){var temp_list=new Array();one_list[cookie_length_limit]=data;for(var i in one_list){if(i<=one_list_length-1){var j=parseInt(i)+1;temp_list[i]=one_list[j.toString()]}}one_list=temp_list}else{one_list[one_list_length]=data}}else{var one_list=new Array();one_list[0]=data}var cookie_list_json=json_encode(one_list);seconds=seconds?seconds:604800;setCookie(cookieName,cookie_list_json,seconds,path,domain,secure);return}function getBooInCookieArr1(cookieName,data){var result_json=getCookie(cookieName);if(result_json){var one_list=json_decode(result_json);if(one_list){for(var i in one_list){if(one_list[i]&&one_list[i]==data){return true}}}}return false}function setCookieArr2(cookieName,param1,param2,seconds,path,domain,secure){var result_json=getCookie(cookieName);var two_list;if(result_json){two_list=json_decode(result_json)}if(two_list){var two_list_length=two_list.length;if(two_list_length>=cookie_length_limit){var temp_list=new Array();two_list[cookie_length_limit]=new Array();two_list[cookie_length_limit][0]=param1;two_list[cookie_length_limit][1]=param2;for(var i in two_list){if(i<=two_list_length-1){var j=parseInt(i)+1;temp_list[i]=two_list[j.toString()]}}two_list=temp_list}else{two_list[two_list_length]=new Array();two_list[two_list_length][0]=param1;two_list[two_list_length][1]=param2}}else{var two_list=new Array();two_list[0]=new Array();two_list[0][0]=param1;two_list[0][1]=param2}var cookie_list_json=json_encode(two_list);seconds=seconds?seconds:604800;setCookie(cookieName,cookie_list_json,seconds,path,domain,secure);return}function getBooInCookieArr2(cookieName,data){var result_json=getCookie(cookieName);if(result_json){var two_list=json_decode(result_json);if(two_list){for(var i in two_list){if(two_list[i]&&two_list[i][0]&&two_list[i][0]==data){return true}}}}return false}$(function(){showHide(".downloadApp","",".more-share-box");document.onkeydown=function(moz_ev){var ev=null;if(window.event){ev=window.event}else{ev=moz_ev}if(ev!=null&&ev.ctrlKey&&ev.keyCode==13){var quick_isFocus=$("#quickComment").is(":focus");var comment_isFocus=$("#textareaComment").is(":focus");var choujiang_isFocus=$("#choujiangComment").is(":focus");if(true==comment_isFocus){$("#textCommentSubmit").click()}if(true==quick_isFocus){$("#textCommentSubmitQuick").click()}if(true==choujiang_isFocus){$("#choujiangCommentSubmit").click()}}};commentQuickReply(".reply");showHide(".comment_list","",".jubao");visibleOrNot(".operate_box",".noGoods","visibility");
visibleOrNot("blockquote",".comment_action","display");tab(".tab_comment_li",".tab_info","current_item","click");openClose(".seaAll","","comments");openClose("a.more","a.pickup","mallNav");$("#textareaComment, .comment_tips").addClass("zhiyou_login");comment_share_to_sina("i.check");$(".textarea_quick").height("auto");$("#quickComment").val("");$("#quickComment").autoTextarea({maxHeight:200});var ok_txt="评论成功，由于系统缓存可能需要1～5分钟后才能在页面中显示。";var txt3='"><i class="icon-loginright"></i> '+ok_txt,txt4='"><i class="icon-loginright"></i> 评论成功，由于系统缓存可能需要1~5分钟后才能在页面中显示。',txt5='"><i class="icon-loginright"></i> 为维护良好讨论环境，新注册用户的评论需人工审核后再显示，请谅解',txt8='"><i class="icon-loginright"></i> <span class="red">你的投票已超过次数限制或未达到投票权限，该评论仅作为普通评论</span>',txt10='评论同步新浪微博失败，您尚未绑定微博账号，<span class="red" id="goback">4</span>秒后将带您进入微博授权页',$submit=$("#commentform #textCommentSubmit"),$submitQuickBtn=$("#commentquickform #textCommentSubmitQuick");$submit.attr("disabled",false);$submitQuickBtn.attr("disabled",false);$("#commentform").submit(function(){if($.trim($("#textareaComment").val())==""||$.trim($("#textareaComment").val())==$("#textareaComment").attr("default_data")){if($("#error").is(":hidden")){$("#error").html("您是不是忘了说点什么？").slideDown().delay(3000).slideUp()}}else{submit_comment(0)}return false});$("#commentquickform").submit(function(){if($.trim($("#quickComment").val())==""||$.trim($("#quickComment").val())==$("#textareaComment").attr("default_data")){if($("#quick_error").is(":hidden")){$("#quick_error").html("您是不是忘了说点什么？").slideDown().delay(3000).slideUp()}}else{submit_comment(1)}return false});var _time_slicing=10;var wait=_time_slicing,submit_val=$submit.html(),waitquick=_time_slicing,quick_submit_val=$submitQuickBtn.html();function countdown(){if(wait>0){$submit.html(wait);wait--;setTimeout(countdown,1000)}else{$submit.html(submit_val).attr("disabled",false).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1);wait=_time_slicing}}function quickcountdown(){if(waitquick>0){$submitQuickBtn.html(waitquick);waitquick--;setTimeout(quickcountdown,1000)}else{$submitQuickBtn.html(quick_submit_val).attr("disabled",false).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1);waitquick=_time_slicing}}function count_down(obj){var secs=parseInt($(obj).html());if(secs>0){$(obj).html(secs-1);setTimeout(function(){count_down(obj)},1000)}if(secs==0){$(".sub_Success").fadeOut();$("#cover").fadeOut()}}function submit_comment(isQuickSumit){var errorContainerId="error";var btn=$submit;var loadingImg=$("#loading");if(1==isQuickSumit){var formObj=$("#commentquickform");errorContainerId="quick_error";btn=$submitQuickBtn;loadingImg=$("#loadingquick")}else{var formObj=$("#commentform")}btn.attr("disabled",true).removeClass("btn_sub").addClass("btn_subGrey").fadeTo("slow",1);loadingImg.show();$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_set_comment",data:formObj.serialize(),dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);loadingImg.hide();if(10==result.error_code){if(result.error_msg.sina_uri){$("#pop-status-fail").find(".pop_info").html(txt10);$("#pop-status-fail").find(".icon-logintanhao").css({"float":"left","margin-left":"15px","margin-top":"15px"});$("#pop-status-fail").fadeIn();$("#cover").fadeIn();popPosition("#pop-status-fail");count_down("#goback");setTimeout(function(){window.location.href=result.error_msg.sina_uri},4000)}else{setTimeout(function(){btn.attr("disabled",false).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1);$("#"+errorContainerId).slideUp()},3000)}return}else{if(0==result.error_code){var div_new=$(".comment_wrap .tab_nav").find(".tab_comment_li:first");div_new.siblings().removeClass("current_item");div_new.addClass("current_item");$("#commentTabBlockNew").css("display","");$("#commentTabBlockHot").css("display","none");if(result.error_msg.sina_uri){window.location.href=result.error_msg.sina_uri;return}var the_floor=0;var floor_grey=$("#commentTabBlockNew ul.comment_listBox li:first .grey").html();if(floor_grey){the_floor=floor_grey.split("楼")[0]}(the_floor)?the_floor=parseInt(the_floor)+1:the_floor=0;var ok_htm='\n<div id="success_1'+txt3+"</div>\n";if(6==result.error_code){ok_htm='\n<div id="success_1'+txt4+"</div>\n"}else{if(8==result.error_code){ok_htm='\n<div id="success_1'+txt8+"</div>\n"}}var new_comment_html="";new_comment_html+='<li id="li_comment_4700621" class="comment_list">';new_comment_html+='<div class="comment_avatar">';new_comment_html+='<a href="javascript:void(0);" class="userPic"><img src="'+result.error_msg.head+'" width="36" height="36"/></a>';new_comment_html+=(the_floor)?'<span class="grey">'+the_floor+"楼</span>":"";new_comment_html+="</div>";new_comment_html+='<div class="comment_conBox">';new_comment_html+='<div class="comment_avatar_time"><div class="time">'+result.error_msg.format_date+"</div>";if(result.error_msg.is_anonymous){new_comment_html+='<span class="grey">'+result.error_msg.display_name+"</span>"}else{new_comment_html+='<a href="javascript:void(0);" class="a_underline user_name">'+result.error_msg.display_name+"</a>"
}new_comment_html+="</div>";new_comment_html+='<div class="comment_conWrap">';new_comment_html+='<div class="comment_con"><p>'+result.error_msg.comment_content+"</p></div>";new_comment_html+=ok_htm;new_comment_html+='<div class="blankDiv"></div>';new_comment_html+="</div>";new_comment_html+="</div>";new_comment_html+='<div class="clear"></div>';new_comment_html+="</li>";$("#comment .tab_nav:first").css("display","block");$("#li_comment_new").after(new_comment_html);setTimeout(function(){$("#success_1").remove()},3000);if(1==isQuickSumit){quickcountdown()}else{countdown()}if(1==isQuickSumit){$("#quickComment").val("")}else{$("#textareaComment").val("")}cancle_vote();$(".commentNum").each(function(){$(this).html(parseInt($(this).html())+1)});$("#quickComment").height("auto");var score=result.error_msg.post_points?result.error_msg.post_points:0;var exp=result.error_msg.post_experience?result.error_msg.post_experience:0;var gold=result.error_msg.post_gold?result.error_msg.post_gold:0;var mana=result.error_msg.post_prestige?result.error_msg.post_prestige:0;if(score!=0||exp!=0||gold!=0||mana!=0){var scoreDom=(score==0)?"":'<span class="comment_score">积分：<em>'+score+"</em></span>";var expDom=(exp==0)?"":'<span class="comment_exp">经验：<em>'+exp+"</em></span>";var goldDom=(gold==0)?"":'<span class="comment_gold">金币：<em>'+gold+"</em></span>";var manaDom=(mana==0)?"":'<span class="comment_mana">威望：<em>'+mana+"</em></span>";$("#pop-comment-score").find(".pop_comment_info").html(scoreDom+expDom+goldDom+manaDom);popUp("","#pop-comment-score","成功发表评论")}if($("#"+errorContainerId).is(":hidden")){$("#"+errorContainerId).html(ok_txt).css("color","green").slideDown().delay(3000).slideUp()}}else{if(7==result.error_code){var msg=result.error_msg;$("body").append('<div class="pop pop_no_title" id="pop-scorenotenough"><i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i><div class="pop-content oneLine"><i class="icon-logintanhao"><!--[if lt IE 8]>404<![endif]--></i><p class="pop_info"></p></div></div>');popUp("","#pop-scorenotenough",msg)}else{var no_htm=result.error_msg;if(5==result.error_code){no_htm="请登录后发表评论"}$("#"+errorContainerId).slideDown().html(no_htm);setTimeout(function(){btn.attr("disabled",false).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1);$("#"+errorContainerId).slideUp()},3000)}}}}})}func_atta();func_report()});function showHide(obj,newClass,subBlock){$(document).on("mouseover",obj,function(){$(this).addClass(newClass);$(this).find(subBlock).show()});$(document).on("mouseout",obj,function(){$(obj).removeClass(newClass);$(obj).find(subBlock).hide()})}function openClose(openObj,closeObj,method){if(method=="mallNav"){$(openObj).click(function(){$(this).prev().css("height","auto");$(this).hide();$(this).next("a").show()});$(closeObj).click(function(){$(this).parent().find("ul").css("height","64px");$(this).hide();$(this).prev("a").show()})}else{if(method=="comments"){var blockquoteNum=$("blockquote").length;for(var i=0;i<blockquoteNum;i++){var maxHeight=$(openObj).prev(".comment_con").eq(i).height();if($(openObj).prev(".comment_con").eq(i).height()==120){$(openObj).eq(i).css("display","block")}else{$(openObj).eq(i).css("display","none")}}$(openObj).click(function(){$(this).prev().css({"height":"auto","max-height":"100%"});$(this).hide();$(this).next("a").show()})}}}function init_action(){if($("#comments .tab_info .comment_listBox").length>0){$(".comment_listBox li.comment_list, .comment_listBox li.comment_list blockquote").each(function(){var commentID=$(this).attr("blockquote_cid");var userID=$(this).find(".user_name:first").attr("usmzdmid");if($(this).hasClass("comment_list")){var commentIdArray=$(this).attr("id").split("_");commentID=commentIdArray[commentIdArray.length-1]}var mosaicDom='<a href="javascript:void(0);" title="打码" onclick="mosaic_show_textarea('+commentID+')">打码</a>';var blackListDom='<a href="http://users.bgm.smzdm.com/blackroom/user_add?smzdm_id='+userID+'" title="关小黑屋" target="_blank">关小黑屋</a>';if(userID==0||userID==undefined){blackListDom=""}var deleteDom='<a href="javascript:void(0);" onclick="delete_comment_confirm('+commentID+')" title="删除">删除</a>';var editDom='<a href="http://comments.bgm.smzdm.com/comments/info/'+commentID+'" title="编辑" target="_blank">编辑</a>';var controls=mosaicDom+blackListDom+deleteDom+editDom;$(this).find(".dingNum:last").before(controls)})}}function func_atta(obj_name){if(!obj_name||typeof(obj_name)==undefined){obj_name="#comment"}$(obj_name+" .atta").click(function(){if(parseInt($("#log_status").val())!=1){zhiyou_relate.popup_login_show()}else{$(window).scrollTop($("#comments").offset().top-50);var textcomment_obj=$("#textareaComment");if(textcomment_obj.length>0){var author=$(this).attr("title");var output=$.trim(textcomment_obj.val());var default_data=$.trim($("#textareaComment").attr("default_data"));if(output==default_data){output=author+" "}else{var out_arr=output.split(" ");var flag=true;for(i=0;i<out_arr.length;i++){if(author==out_arr[i]){flag=false;
break}}if(flag){output=author+" "+output+" "}else{output+=" "}}textcomment_obj.focus().val(output);return true}}return true})}function func_report(obj_name){if(!obj_name||typeof(obj_name)==undefined){obj_name="#comment"}$(obj_name+" .jubao").each(function(){if($(this).attr("id")){var report_cid=$(this).attr("id").split("_")[1];if(report_cid==""||report_cid==null||report_cid=="0"){return false}var result_json=getCookie(comment_report_cookiename);if(result_json){var comment_report_cookie_list=json_decode(result_json);if(comment_report_cookie_list){for(var i in comment_report_cookie_list){if(comment_report_cookie_list[i]&&comment_report_cookie_list[i]==report_cid){has_report_omment(report_cid)}}}}}}).click(function(){if($(this).attr("id")){var report_cid=$(this).attr("id").split("_")[1];if(report_cid==""||report_cid==null||report_cid=="0"){return false}var boo_in_cookie=getBooInCookieArr1(comment_report_cookiename,report_cid);if(boo_in_cookie){setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain);popUp("","#pop-status-fail-twoLine","您已经举报过了，我们正在处理，多谢反馈！");return false}var report_type=1;var report_text="";popPosition("#pop-report");$("#pop-report").show(function(){$(this).find("input[type='radio']").removeAttr("checked").click(function(){var n=$(this).attr("id").split("_")[2];report_type=n;if(n==9){$("#pop_report_opinion").show();$("#pop_report_submit").attr("disabled","disabled").removeClass("btn_login").addClass("btn_grey");$("#pop_report_opinion").find("textarea").bind("keyup mouseup",function(){var len=$(this).val().length;report_text=$("#pop_report_opinion").find("textarea").val();if(len>=10){$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login")}else{$("#pop_report_submit").attr("disabled","disabled").removeClass("btn_login").addClass("btn_grey")}})}else{report_text="";if($("#pop_report_opinion").is(":visible")){$("#pop_report_opinion").hide();$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login")}}})});$("#cover").show();popClose("#pop-report");$("#pop_report_submit").unbind("click").click(function(){$("#pop-report,#cover").hide();$("#pop_report_opinion").hide();$("#pop_report_opinion").find("textarea").val("");$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_comment_report",data:"type="+report_type+"&content="+report_text+"&cid="+report_cid,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(0==result.error_code){has_report_omment(report_cid);setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain);popUp("","#pop-status-success","举报成功！")}else{if(result.error_msg){popUp("","#pop-status-fail",result.error_msg)}else{popUp("","#pop-status-fail","举报失败！")}}return},error:function(){popUp("","#pop-status-fail","网络错误")}})});return}})}function commentReport(commentid,obj){var span_aid=obj.attr("id");if(!span_aid||span_aid==undefined||typeof(span_aid)==undefined){return}var report_cid=span_aid.split("_")[1];if(report_cid==""||report_cid==null||report_cid=="0"){return false}var boo_in_cookie=getBooInCookieArr1(comment_report_cookiename,report_cid);if(boo_in_cookie){setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain);popUp("","#pop-status-fail-twoLine","您已经举报过了，我们正在处理，多谢反馈！");return false}var report_type=1;var report_text="";popPosition("#pop-report");$("#pop-report").css({"position":"fixed","top":"50%","left":"50%","margin-left":"-240px","margin-top":"-165px"}).show(function(){$("#pop_report_opinion").hide();$(this).find("input[type='radio']").removeAttr("checked").click(function(){var n=$(this).attr("id").split("_")[2];report_type=n;if(n==9){$("#pop_report_opinion").show();$("#pop_report_submit").attr("disabled","disabled").addClass("btn_grey");$("#pop_report_opinion").find("textarea").show().bind("keyup mouseup",function(){var len=$(this).val().length;report_text=$("#pop_report_opinion").find("textarea").val();if(len>=10){$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login")}else{$("#pop_report_submit").attr("disabled","disabled").addClass("btn_grey")}})}else{report_text="";if($("#pop_report_opinion").is(":visible")){$("#pop_report_opinion").hide().find("textarea").hide();$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login")}}})});$("#cover").show();popClose("#pop-report");$("#pop_report_submit").unbind("click").click(function(){$("#pop-report,#cover").hide();$("#pop_report_opinion").hide();$("#pop_report_opinion").find("textarea").val("");$(this).attr("disabled","disabled").addClass("btn_grey");$(".pop_report_opinion p").html("最少输入10个字").attr("class","grey");$.ajax({type:"POST",url:"/user/comment/ajax_report",data:"type="+report_type+"&content="+report_text+"&cid="+report_cid,dataType:"json",success:function(data){$(this).removeAttr("disabled").removeClass("btn_grey").addClass("btn_login");var result=eval(data);if(0==result.error_code){has_report_omment(report_cid);
$("#report_"+report_cid).removeAttr("onclick").html("已举报");setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain);popUp("","#pop-status-success","举报成功！")}else{if(result.error_msg){popUp("","#pop-status-fail",result.error_msg)}else{popUp("","#pop-status-fail","举报失败")}}return},error:function(){popUp("","#pop-status-fail","网络错误")}});$(this).removeAttr("disabled").removeClass("btn_grey").addClass("btn_login");return false});return false}function has_report_omment(id){$("#comment .tab_info .comment_listBox li #report_"+id).removeAttr("onclick").addClass("comment-report").html("已举报");return}function get_rating_num(licid,cid,isding){var numID="cdc_support_"+cid;if(0==isding){numID="cdc_oppose_"+cid}var rs=$("#li_comment_"+licid+" #"+numID+":first span").html();if(rs){var st=rs.split("(")[1];rs=st.split(")")[0];(rs)?rs=parseInt(rs):rs=0}else{rs=0}return rs}function has_rating_omment(id,isding,dingnum,cainum){if(1==isding){$("#comment .tab_info .comment_listBox li #cdc_support_"+id).removeAttr("onclick").addClass("current").html("顶<span>("+dingnum+")</span>");$("#comment .tab_info .comment_listBox li #cdc_oppose_"+id).removeAttr("onclick").removeClass("current")}else{$("#comment .tab_info .comment_listBox li #cdc_support_"+id).removeAttr("onclick").removeClass("current");$("#comment .tab_info .comment_listBox li #cdc_oppose_"+id).removeAttr("onclick").addClass("current").html("踩<span>("+cainum+")</span>")}return}function init_smile(){var default_data=$.trim($("#textareaComment").attr("default_data"));$(".icon-small").each(function(){$(this).click(function(){$(".smileLayerBg").hide();if($(this).attr("isclick")=="1"){$(this).removeAttr("isclick")}else{$(".icon-small").each(function(){$(this).removeAttr("isclick")});$(this).attr("isclick","1");var layerP=$(this).parent();layerP.find(".smileLayerBg").show();layerP.find(".smileLayerBg .smileBox").hide().eq(0).show();layerP.find(".smileLayerBg .smilePage a").removeAttr("class").eq(0).attr("class","current")}})});$(".smilePage a").click(function(){$(this).addClass("current").siblings().removeClass("current");$(".smileBox").hide().eq($(".smilePage a").index(this)).show()});$(".smileLayerBg li a").each(function(){$(this).click(function(){var temp_div=$(this).parent().parent().parent().parent();var textarea_obj=temp_div.parent().parent().find("textarea:first");temp_div.find(".smileLayerBg").css("display","none");temp_div.find(".icon-small").removeAttr("isclick");var dstr=textarea_obj.attr("default");var str=textarea_obj.val();if(str==default_data){str=""}var sstr=str;if(dstr){var sstr=str.replace(dstr,"")}textarea_obj.val(sstr);textarea_obj.insertContent($(this).attr("default-data"))})});return false}function init_comment_rating(obj_name){var result_json=getCookie(comment_rating_cookiename);if(result_json){if(!obj_name||typeof(obj_name)==undefined){obj_name="#comment"}$(obj_name+" .dingNum").each(function(){if($(this).attr("id")){var rating_cid=$(this).attr("id").split("_")[2];if(rating_cid==""||rating_cid==null||rating_cid=="0"){return false}var comment_rating_cookie_list=json_decode(result_json);if(comment_rating_cookie_list){for(var i in comment_rating_cookie_list){if(comment_rating_cookie_list[i]&&comment_rating_cookie_list[i][0]&&comment_rating_cookie_list[i][0]==rating_cid){if("1"==comment_rating_cookie_list[i][1]){$("#comment .tab_info .comment_listBox li #cdc_support_"+rating_cid).removeAttr("onclick").removeClass("current").addClass("current");$("#comment .tab_info .comment_listBox li #cdc_oppose_"+rating_cid).removeAttr("onclick").removeClass("current")}else{$("#comment .tab_info .comment_listBox li #cdc_support_"+rating_cid).removeAttr("onclick").removeClass("current");$("#comment .tab_info .comment_listBox li #cdc_oppose_"+rating_cid).removeAttr("onclick").removeClass("current").addClass("current")}}}}}})}}function comment_rating_ajax(type,rating,comment_id,pid,licid){var dingnum=get_rating_num(licid,comment_id,1);var cainum=get_rating_num(licid,comment_id,0);var boo_in_cookie=getBooInCookieArr2(comment_rating_cookiename,comment_id);if(boo_in_cookie){has_rating_omment(comment_id,rating,dingnum,cainum);setCookieArr2(comment_rating_cookiename,comment_id,rating,604800,"/",smzdm_domain);alert("您已打分");return false}$.ajax({type:"GET",url:zhiyou_relate.baseUrl+"user/comment/ajax_rating",data:"comment_id="+comment_id+"&rating="+rating,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(rating==0){cainum=cainum+1}else{dingnum=dingnum+1}has_rating_omment(comment_id,rating,dingnum,cainum);if(0==result.error_code){setCookieArr2(comment_rating_cookiename,comment_id,rating,604800,"/",smzdm_domain)}return}});return}function show_confirm(){$("#pop-tips").css({"left":"50%","margin-left":"-240px","top":"50%","margin-top":"-115px"}).show();$("#cover").show();$("#layerBtnL").removeAttr("onclick");$("#cover").on("click",function(){close_submit_confirm()})}function del_comment_confirm(comment_id){show_confirm();$("#layerBtnL").bind("click",function(){close_submit_confirm();
del_comment(comment_id,0)})}function del_comment(comment_id,operator){$.ajax({type:"POST",url:zhiyou_relate.baseUrl+"user/comment/ajax_del_comment",data:"comment_id="+comment_id+"&operator="+operator,dataType:"jsonp",jsonp:"callback",success:function(data){if(0==data.error_code){if(typeof($("#div_comment_"+comment_id))!=undefined){$("#div_comment_"+comment_id).remove()}popUp("","#pop-status-success","删除成功")}else{if(data.error_msg){popUp("","#pop-status-fail",data.error_msg)}else{popUp("","#pop-status-fail","操作失败")}}},error:function(){popUp("","#pop-status-fail","网络错误")}})}function delete_comment_confirm(comment_id){if(window.confirm("确定删除该评论？")){commentDelete(comment_id,1)}}function commentDelete(comment_id,operator){$.ajax({type:"POST",url:zhiyou_relate.baseUrl+"user/comment/ajax_del_comment",data:"comment_id="+comment_id+"&operator="+operator,dataType:"jsonp",jsonp:"callback",success:function(data){if(data.error_code==0){$(".comment_listBox").find("#li_comment_"+comment_id).remove();$(".comment_listBox").find("[blockquote_cid='"+comment_id+"']").remove();popUp("","#pop-status-success","删除成功")}}})}(function($){$.fn.extend({insertContent:function(myValue,t){var $t=$(this)[0];if(document.selection){this.focus();var sel=document.selection.createRange();sel.text=myValue;this.focus();sel.moveStart("character",-l);var wee=sel.text.length;if(arguments.length==2){var l=$t.value.length;sel.moveEnd("character",wee+t);t<=0?sel.moveStart("character",wee-2*t-myValue.length):sel.moveStart("character",wee-t-myValue.length);sel.select()}}else{if($t.selectionStart||$t.selectionStart=="0"){var startPos=$t.selectionStart;var endPos=$t.selectionEnd;var scrollTop=$t.scrollTop;$t.value=$t.value.substring(0,startPos)+myValue+$t.value.substring(endPos,$t.value.length);this.focus();$t.selectionStart=startPos+myValue.length;$t.selectionEnd=startPos+myValue.length;$t.scrollTop=scrollTop;if(arguments.length==2){$t.setSelectionRange(startPos-t,$t.selectionEnd+t);this.focus()}}else{this.value+=myValue;this.focus()}}}})})(jQuery);function clearReplyCss(){$("#quickComment").val("");$(".textarea_quick").height("auto")}function commentQuickReply(obj){$(obj).click(function(){if(parseInt($("#log_status").val())!=1){zhiyou_relate.popup_login_show()}else{clearReplyCss();var reply_div=$("#quickReply");var parentid=0;if($(this).attr("id")){parentid=$(this).attr("id").split("_")[2];if(parentid==""||parentid==null||parentid=="0"||parentid==0){parentid=0}reply_div.find("#parentid").val(parentid)}var blank_div=$(this).parent().parent(".comment_conWrap").find(".blankDiv");if($(blank_div).html()==""){$(blank_div).html(reply_div);$("#quickReply").show();$(this).parent(".comment_action").css({display:"block",visibility:"visible"})}else{$("#quickReplyDiv").html(reply_div)}}})}function visibleOrNot(target,parentObj,method){$(target).hover(function(){if(method="visibility"){$(this).children().find(parentObj).css("visibility","visible")}else{if(method="display"){$(this).children().find(parentObj).css("display","block")}}},function(){if(method="visibility"){$(this).children().find(parentObj).css("visibility","hidden")}else{if(method="display"){$(this).children().find(parentObj).css("display","none")}}})}function popClose(o){$(o).find(".pop-close").click(function(){$(o).hide();$("#cover").hide()});$("#cover").click(function(){$(o).hide();$("#cover").hide()})}function popUp(source,o,txt){if(source!=""){$(source).click(function(){popPosition(o);$(o).show();$("#cover").show();popClose(o)})}else{$(o).find(".pop_info").html(txt);popPosition(o);$(o).show();$("#cover").show();setTimeout(function(){$(o).hide();$("#cover").hide()},2000);popClose(o)}}function comment_share_to_sina(obj){$(obj).click(function(){var temp_has=0;if($(this).hasClass("icon-rightframe")){temp_has=1;var is_comment_connect="no";$("#comments .comment_share i.check").removeClass("icon-rightframe")}else{temp_has=0;var is_comment_connect="yes";$("#comments .comment_share i.check").addClass("icon-rightframe")}$.ajax({type:"POST",url:"/ajax_set_weibo_connect",data:"isconnect="+is_comment_connect,dataType:"json",success:function(data){if(0!=data.error_code){popUp("","#pop-status-fail",data.error_msg);if(temp_has){$("#comments .comment_share i.check").addClass("icon-rightframe")}else{$("#comments .comment_share i.check").removeClass("icon-rightframe")}}return true}})});return false}var comment_tpl={"item":'<blockquote class="comment_blockquote" blockquote_cid="{comment_id}"><div class="comment_floor">{depth}</div><div class="comment_conWrap"><div class="comment_con">{user_display_name}</div><div class="comment_action"><a class="jubao" href="javascript:void(0);" id="report_{comment_id}">举报</a><a class="dingNum {ding_class}" href="javascript:void(0);" id="cdc_support_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 1, {comment_id}, {article_id}, {li_comment_id});">顶<span>({up_num})</span></a><a class="caiNum" href="javascript:void(0);" id="cdc_oppose_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 0, {comment_id}, {article_id}, {li_comment_id});">踩<span>({down_num})</span></a>{atta}<a class="reply" href="javascript:void(0);" id="cdc_reply_{comment_id}">回复</a></div><div class="blankDiv"></div></div></blockquote>',"item_no_atta_reply":'<blockquote class="comment_blockquote" blockquote_cid="{comment_id}"><div class="comment_floor">{depth}</div><div class="comment_conWrap"><div class="comment_con">{user_display_name}</div><div class="comment_action"><a class="jubao" href="javascript:void(0);" id="report_{comment_id}">举报</a><a class="dingNum {ding_class}" href="javascript:void(0);" id="cdc_support_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 1, {comment_id}, {article_id}, {li_comment_id});">顶<span>({up_num})</span></a><a class="caiNum" href="javascript:void(0);" id="cdc_oppose_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 0, {comment_id}, {article_id}, {li_comment_id});">踩<span>({down_num})</span></a></div><div class="blankDiv"></div></div></blockquote>',};
function show_floors(comment_id,article_id,cate,channel_id,show_at_replay){if(!comment_id||typeof(comment_id)==undefined||!cate||typeof(cate)==undefined||(cate!="New"&&cate!="Hot")){popUp("","#pop-status-fail","网络错误！");return}if(typeof(show_at_replay)==undefined){show_at_replay=1}var blockquote_obj=$("#commentTabBlock"+cate+" #li_comment_"+comment_id+" .blockquote_wrap");blockquote_obj.find(".comment_showAll").html('<a class="a_underline" href="javascript:void(0);">加载中，请稍候。。。</a>');if(!article_id||typeof(article_id)==undefined||!channel_id||typeof(channel_id)==undefined){blockquote_obj.find(".comment_showAll").html('<a class="a_underline" href="javascript:void(0);">网络错误，请刷新重试</a>')}var reply_div=$("#quickReply");var is_bgm=$("#is_bgm").val();$.ajax({type:"GET",url:zhiyou_relate.baseUrl+"user/comment/ajax_show_floors",data:"comment_id="+comment_id+"&article_id="+article_id+"&channel_id="+channel_id,dataType:"jsonp",jsonp:"callback",success:function(res){if(res.error_code>0){blockquote_obj.find(".comment_showAll").html('<a class="a_underline" href="javascript:void(0);" onclick="show_floors('+comment_id+","+article_id+", '"+cate+"', '"+channel_id+"', "+show_at_replay+')">网络错误，请重试</a>');return}if(show_at_replay){var tpl_item=comment_tpl.item}else{var tpl_item=comment_tpl.item_no_atta_reply}var comment_list=new StringBuilder("").onMultiAppendBefore(function(param){param["li_comment_id"]=res.data.li_comment_id;param["article_id"]=res.data.article_id;param["channel_id"]=res.data.channel_id;param["user_display_name"]="";param["atta"]="";if(param["home_ta"]){param["user_display_name"]='<a class="a_underline user_name" target="_blank" href="'+param["home_ta"]+'" usmzdmid="'+param["smzdm_id"]+'">'+param["display_name"]+param["post_author"]+"</a>：<p>"+param["content"]+"</p>"}else{param["user_display_name"]='<span class="grey">'+param["display_name"]+param["post_author"]+"</span>：<p>"+param["content"]+"</p>"}if(1!=param["is_anonymous"]){param["atta"]='<a class="atta" href="javascript:void(0);" title="@'+param["display_name"]+'">@TA</a>'}}).appendMultiFormat(tpl_item,res.data.comment_rows).toString();blockquote_obj.html(comment_list);visibleOrNot(".operate_box",".noGoods","visibility");visibleOrNot("blockquote",".comment_action","display");commentQuickReply(blockquote_obj.find(".reply"));if(is_bgm&&typeof(is_bgm)!=undefined&&blockquote_obj.find("blockquote").length>0){blockquote_obj.find("blockquote").each(function(){var commentID=$(this).attr("blockquote_cid");var userID=$(this).find(".user_name:first").attr("usmzdmid");var mosaicDom='<a href="javascript:void(0);" title="打码" onclick="mosaic_show_textarea('+commentID+')">打码</a>';var blackListDom='<a href="http://users.bgm.smzdm.com/blackroom/user_add?smzdm_id='+userID+'" title="关小黑屋" target="_blank">关小黑屋</a>';if(userID==0||userID==undefined){blackListDom=""}var deleteDom='<a href="javascript:void(0);" onclick="delete_comment_confirm('+commentID+')" title="删除">删除</a>';var editDom='<a href="http://comments.bgm.smzdm.com/comments/info/'+commentID+'" title="编辑" target="_blank">编辑</a>';var controls=mosaicDom+blackListDom+deleteDom+editDom;$(this).find(".dingNum:last").before(controls)})}var quick_reply_obj=$("#quickReplyDiv");if($.trim(quick_reply_obj.html())==""){reply_div.find("#parentid").val(0);quick_reply_obj.html(reply_div)}init_comment_rating("#li_comment_"+comment_id+" .blockquote_wrap");func_atta("#li_comment_"+comment_id+" .blockquote_wrap");func_report("#li_comment_"+comment_id+" .blockquote_wrap");return}});return}function mosaic_show_textarea(cid){$("#pop-mosaic").remove();var article_id=$.trim($("#commentform #pid").val());var channel_id=$.trim($("#commentform #type").val());$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_content/",data:"comment_id="+cid+"&article_id="+article_id,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(0!=result.error_code){alert(result.error_msg);return false}var old_content=result.data;var html_txt='<div class="pop pop_main_box" id="pop-mosaic" style="display:block;margin-left:-240px;margin-top:-138px;">'+'<i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i>'+'<div class="pop-title"><div class="pop_name">打码</div></div>'+'<div class="pop-content">'+'<div class="pop_width_420">'+'<form id="commentform_'+cid+'">'+'<input type="hidden" name="comment_id" value="'+cid+'" readonly="readonly" />'+'<input type="hidden" name="article_id" value="'+article_id+'" readonly="readonly" />'+'<input type="hidden" name="channel_id" value="'+channel_id+'" readonly="readonly" />'+'<textarea name="old_content" id="old_content" readonly="readonly" style="display:none;">'+old_content+"</textarea>"+'<textarea name="content" id="txt_content_'+cid+'" class="textarea" id="mosaic-textarea" cols="60" rows="5">'+old_content+"</textarea>"+'<div class="a_blockBox"><a href="javascript:void(0);" class="a_redBlock" id="mosaicbtn_'+cid+'" onclick="mosaic_comment('+cid+')">打&nbsp;&nbsp;码</a></div>'+"</form>"+"</div>"+"</div>"+"</div>";
var cover=$("#cover");cover.css("display","block");cover.click(function(){$(this).hide();$("#pop-mosaic").hide()});$("#comment").after(html_txt);$("#pop-mosaic").delegate(".pop-close","click",function(){$("#pop-mosaic").hide();cover.css("display","none")});return true},error:function(){alert("网络错误")}});return true}function get_select_txt(id){var select_field=document.getElementById(id);var word="";if(document.selection){var sel=document.selection.createRange();if(sel.text.length>0){word=sel.text}}else{if(select_field.selectionStart||select_field.selectionStart=="0"){var startP=select_field.selectionStart;var endP=select_field.selectionEnd;if(startP!=endP){word=select_field.value.substring(startP,endP)}}}return word}function mosaic_comment(cid){var mosaic_pre="〖「【《";var mosaic_suf="》】」〗";var mosaic_btn=$("#mosaicbtn_"+cid);var txt_obj=$("#txt_content_"+cid);txt_obj.attr("disabled","disabled");mosaic_btn.attr("disabled","disabled").html("打码中");var con=$.trim(txt_obj.val());var old_con=con;var have_mosaic=con.indexOf(mosaic_pre)>=0||con.indexOf(mosaic_suf)>=0;var sel_txt=get_select_txt("txt_content_"+cid);var con_len=strlen(con);if(con_len>900){alert("该评论内容过长，请去后台操作");txt_obj.removeAttr("disabled");mosaic_btn.removeAttr("disabled").html("打码");return false}if(sel_txt){var newcon=$.trim(txt_obj.val());if(newcon.indexOf(mosaic_pre)>=0||newcon.indexOf(mosaic_suf)>=0){if(confirm("已经有打码内容，请注意不要嵌套打码")){txt_obj.insertContent(mosaic_pre+sel_txt+mosaic_suf)}else{txt_obj.removeAttr("disabled");mosaic_btn.removeAttr("disabled").html("打码");return true}}else{txt_obj.insertContent(mosaic_pre+sel_txt+mosaic_suf)}}else{var regObj={"〖「【《":"","》】」〗":""};for(reg in regObj){con=con.replace(new RegExp(reg,"g"),regObj[reg])}txt_obj.val(con)}txt_obj.removeAttr("disabled");mosaic_btn.removeAttr("disabled").html("打码");$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_edit/",data:$("#commentform_"+cid).serialize(),dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(0!=result.error_code){alert(result.error_msg);return false}$(".p_content_"+cid).html(result.data);$("#pop-mosaic").find("#old_content").val(con);return},error:function(XMLHttpRequest){popUp("","#pop-status-fail","网络错误")}});return true}function strlen(s){var w=0;for(var i=0;i<s.length;i++){var c=s.charCodeAt(i);if((c>=1&&c<=126)||(65376<=c&&c<=65439)){w++}else{w+=2}}return w}function vote_by_post_comment(vote_id,post_id,vote_type){if(vote_type!="os"&&vote_type!="exp"){return}if(vote_pid!=post_id){return}if(typeof(vote_id)=="undefined"){return}if(vote_id==""||vote_id==0){return}var thisUri=document.URL;var toUri=smzdm_site_domain+"youhui/"+post_id;if(thisUri.indexOf(toUri)>=0){var t=$("#respond").offset().top;$(window).scrollTop(t-300)}else{setCookie(vote_id_cookie_key,vote_id,30);setCookie(vote_type_cookie_key,vote_type,30);window.open(toUri+"#comments","_blank")}show_vote_div(vote_id,vote_type);return false}function show_vote_div(vote_id,vote_type){$("#vote_id").val(vote_id);$("#vote_type").val(vote_type);var vote_div=$("#hidden_vote_div");if(vote_div){vote_div.css("display","").html("")}var vote_title=$("#vote_"+vote_type+"_"+vote_id).html();$("#hidden_vote_div").css("display","block").html('<div id="cdc_vote_div" class="voteDiv" style="margin: -5px 10px 10px 0px; color: rgb(187, 2, 0); padding-left: 74px; width: 610px; line-height: 1.6em;">请填写推荐理由，提交后即可为《'+vote_title+"》投票。</div>");return false}function cancle_vote(){$("#vote_id").attr("value",0);$("#vote_type").attr("value","");var vote_div=$("#hidden_vote_div");if(vote_div){vote_div.css("display","none").html("")}};